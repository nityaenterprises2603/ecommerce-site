<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nitya Enterprises — E-Commerce</title>
  <meta name="description" content="Oxidized Jewellery & Traditional Clothing — Browse, select size, add to bucket, pay via UPI, and place your order on email & WhatsApp."/>
  <style>
    :root{
      --maroon:#6A0D25; --orange:#FF6600; --bg:#fff8f3; --ink:#222;
      --muted:#666; --card:#ffffff; --ring: rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    a{color:inherit}
    header{position:sticky;top:0;z-index:50;background:var(--maroon);color:#fff;border-bottom:3px solid var(--orange)}
    .wrap{max-width:1100px;margin:auto;padding:0 16px}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;gap:10px;align-items:center}
    .brand .logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--orange),#ffa366);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    .brand h1{font-size:1.05rem;margin:0;letter-spacing:.3px}
    .menu{display:flex;flex-wrap:wrap;gap:10px}
    .menu a{padding:8px 10px;border-radius:8px;color:#fff;text-decoration:none}
    .menu a:hover{background:rgba(255,255,255,.12)}
    .bucket-btn, .stock-btn{display:inline-flex;gap:8px;align-items:center;background:var(--orange);color:#fff;padding:8px 12px;border-radius:999px;border:none;font-weight:700;cursor:pointer}
    .stock-btn{background:#ffffff22;border:1px solid #ffffff55}
    .count{background:#fff;color:var(--orange);font-weight:800;border-radius:999px;padding:2px 8px}

    .hero{background:linear-gradient(180deg,rgba(106,13,37,.10),rgba(255,102,0,.08));padding:28px 0}
    .hero h2{margin:6px 0;font-size:1.6rem}
    .hero p{color:#2d2d2d;margin:6px 0 2px}
    .tag{display:inline-block;background:#fff;border:1px solid var(--ring);padding:6px 10px;border-radius:999px;margin-top:8px}

    .section{padding:28px 0}
    .section h3{margin:0 0 14px;font-size:1.25rem;color:var(--maroon)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;overflow:hidden;box-shadow:0 3px 10px rgba(0,0,0,.06);transition:.2s ease}
    .card:hover{transform:translateY(-2px)}
    .thumb{width:100%;height:280px;object-fit:cover;background:#f1f1f1;display:block}
    .pad{padding:12px}
    .title{font-weight:700;margin:0 0 4px}
    .price{color:var(--muted);font-size:.95rem}

    /* size buttons + stock */
    .sizes{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .size-btn{border:1px solid var(--ring);background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:6px}
    .size-btn[aria-pressed="true"]{background:var(--maroon);color:#fff;border-color:var(--maroon)}
    .size-btn[disabled]{opacity:.45;text-decoration:line-through;cursor:not-allowed}
    .stockchip{font-size:.75rem;padding:2px 6px;border-radius:999px;border:1px solid var(--ring)}
    .size-hint{font-size:.85rem;color:var(--muted);margin-top:6px}

    .btns{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;display:inline-flex;align-items:center;justify-content:center;gap:8px;border-radius:10px;padding:8px 10px;border:1px solid var(--ring);background:#fff;cursor:pointer}
    .btn.add{background:var(--orange);border-color:var(--orange);color:#fff;font-weight:700}
    .btn.remove{color:var(--maroon);font-weight:700}
    .btn.bucket{background:var(--maroon);color:#fff}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    /* Bucket panel */
    .drawer{position:fixed;right:0;top:0;height:100dvh;width:min(420px,95vw);background:#fff;border-left:3px solid var(--orange);box-shadow:-8px 0 20px rgba(0,0,0,.12);transform:translateX(105%);transition:.28s ease;z-index:60;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer header{background:#fff;color:#000;border-bottom:1px solid var(--ring)}
    .drawer h4{margin:0;font-size:1.1rem}
    .drawer .body{padding:12px;overflow:auto;flex:1}
    .cart-item{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border-bottom:1px dashed var(--ring);padding:10px 0}
    .cart-item img{width:56px;height:42px;object-fit:cover;border-radius:6px}
    .small{color:var(--muted);font-size:.9rem}
    .row{display:flex;justify-content:space-between;gap:10px;margin:6px 0}
    .total{font-weight:800;font-size:1.05rem}

    .order{background:#fff;border:1px solid var(--ring);border-radius:14px;padding:14px}
    form label{display:block;margin-top:12px;font-weight:600}
    form input, form textarea, form select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--ring);background:#fff}
    form textarea{min-height:120px}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .cta{background:var(--orange);color:#fff;border:none;padding:10px 14px;border-radius:999px;font-weight:800;cursor:pointer}
    .ghost{background:#fff;color:var(--maroon);border:2px solid var(--maroon)}

    .upi{display:grid;grid-template-columns:1fr auto;gap:14px;align-items:center;margin-top:10px}
    .upi .qr{width:220px;height:220px;border-radius:8px;border:1px solid var(--ring);overflow:hidden;display:flex;align-items:center;justify-content:center;background:#fff}
    .muted{color:var(--muted)}
    footer{background:var(--maroon);color:#fff;margin-top:28px}
    footer .wrap{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:14px 16px}
    code.kbd{background:#fff2e6;border:1px solid var(--orange);padding:2px 6px;border-radius:6px}
    .badge{display:inline-block;background:var(--maroon);color:#fff;padding:6px 12px;border-radius:999px;margin-bottom:10px;font-weight:700}
    .subnav{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 14px}
    .subnav a{background:#fff;border:1px solid var(--ring);padding:6px 10px;border-radius:999px;text-decoration:none}
    .subnav a:hover{border-color:var(--orange)}
    @media (max-width:720px){ .upi{grid-template-columns:1fr} }
  
/* ==== Stock Manager Login Modal ==== */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;z-index:80}
.modal-backdrop.open{display:block}
.modal{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:81;
  padding:16px;pointer-events:none;
}
.modal .card{
  pointer-events:auto;background:#fff;border:1px solid var(--ring);border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.18);max-width:360px;width:100%;padding:16px;
}
.modal .row{display:flex;gap:8px;align-items:center}
.modal .title{font-weight:800;margin:0 0 6px;color:var(--maroon)}
.modal input[type="password"], .modal input[type="text"]{width:100%;padding:10px;border:1px solid var(--ring);border-radius:10px}
.modal .err{color:#b91c1c;font-size:.9rem;min-height:1.2em;margin:4px 0 0}
.modal .actions{display:flex;gap:8px;margin-top:10px}

</style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">
        <div class="logo" aria-hidden="true">NE</div>
        <h1>Oxidized Jewellery & Traditional Clothing</h1>
      </div>
      <nav class="menu" aria-label="Main Navigation">
        <a href="#jewellery">Jewellery</a>
        <a href="#traditional">Traditional Clothing</a>
        <a href="#order">Order</a>
        <a href="#contact">Contact</a>
        <a href="#Exchange Policy">Exchange Policy</a>
        <!-- NEW: Stock Manager + Bucket -->
        <button class="stock-btn" id="openStock">Stock Manager</button>
        <button class="bucket-btn" id="openBucket" title="Open Bucket" aria-haspopup="dialog">
          🧺 Bucket <span class="count" id="bucketCount">0</span>
        </button>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h2>Shop handcrafted Oxidized Jewellery & Traditional Wear</h2>
      <p>Add items to your <strong>Bucket</strong>, pick <strong>Size</strong> where required, pay via <strong>UPI</strong>, then send your order by <strong>Email</strong> & <strong>WhatsApp</strong>.</p>
    </div>
  </section>

  <!-- Oxidized Jewellery -->
  <section id="jewellery" class="section wrap">
    <span class="badge">Main Category: Jewellery</span>
    <div class="subnav" aria-label="Jewellery subcategories">
      <a href="#Earrings">Earrings</a>
      <a href="#Necklaces">Necklaces</a>
      <a href="#Rings">Rings</a>
      <a href="#Anklets">Anklets</a>
      <a href="#Bangles">Bangles</a>
      <a href="#Bracelets">Bracelets</a>
    </div>

    <div id="Earrings"><h3>Earrings</h3><div class="grid" data-grid="Earrings"></div></div>
    <div id="Necklaces"><h3>Necklaces</h3><div class="grid" data-grid="Necklaces"></div></div>
    <div id="Rings"><h3>Rings</h3><div class="grid" data-grid="Rings"></div></div>
    <div id="Anklets"><h3>Anklets</h3><div class="grid" data-grid="Anklets"></div></div>
    <div id="Bangles"><h3>Bangles</h3><div class="grid" data-grid="Bangles"></div></div>
    <div id="Bracelets"><h3>Bracelets</h3><div class="grid" data-grid="Bracelets"></div></div>
  </section>

  <!-- Traditional Clothing -->
  <section id="traditional" class="section wrap">
    <span class="badge">Main Category: Traditional Clothing</span>
    <div class="subnav" aria-label="Traditional subcategories">
      <a href="#ChaniyaCholi">Chaniya Choli</a>
      <a href="#Kurtis">Kurtis</a>
      <a href="#Kurta">Kurta</a>
    </div>
    <div id="ChaniyaCholi"><h3>Chaniya Choli</h3><div class="grid" data-grid="Chaniya Choli"></div></div>
    <div id="Kurtis"><h3>Kurtis</h3><div class="grid" data-grid="Kurtis"></div></div>
    <div id="Kurta"><h3>Kurta</h3><div class="grid" data-grid="Kurta"></div></div>
  </section>

  <!-- Order & Payment -->
  <section id="order" class="section wrap">
    <h3>Order & Payment</h3>
    <div class="order">
      <p class="muted">Fill your details, review your bucket, then <strong>submit by Email</strong> and/or <strong>send via WhatsApp</strong>. Pay securely using the UPI options below.</p>

      <div class="row"><span>Grand Total:</span> <span class="total" id="grandTotal">₹0</span></div>

      <div class="upi" aria-label="UPI payment options">
        <div>
          <label>UPI ID</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="upiId" value="7990639743@ybl" readonly />
            <button class="btn" id="copyUpi">Copy</button>
          </div>
          <div class="actions">
            <a id="upiDeepLink" class="cta" href="#" target="_blank" rel="nofollow noopener">Pay via UPI App</a>
            <button class="btn ghost" id="refreshQR" type="button">Refresh QR for Current Total</button>
          </div>
          <p class="muted" style="margin:6px 0 0"> Deep link & QR use the amount in your bucket (updates live).</p>
        </div>
        <div class="qr" id="qrBox" aria-label="UPI QR Code"><span class="muted" id="qrHint">QR</span></div>
      </div>

      <form id="orderForm" action="https://formsubmit.co/salesnityaenterprises@gmail.com" method="POST" novalidate>
        <input type="hidden" name="_subject" value="New Order — Nitya Enterprises"/>
        <input type="hidden" name="_captcha" value="false"/>
        <input type="hidden" name="_template" value="table"/>
        <input type="hidden" name="order_details" id="order_details"/>
        <input type="hidden" name="order_total" id="order_total"/>

        <label for="custName">Customer Name</label>
        <input id="custName" name="customer_name" placeholder="Your full name" required />

        <label for="mobile">Customer Mobile No (10 digits)</label>
        <input id="mobile" name="customer_mobile" inputmode="numeric" pattern="[0-9]{10}" placeholder="e.g., 9510683160" required />

        <label for="altContact">Contact No (Alternate)</label>
        <input id="altContact" name="alternate_contact" inputmode="numeric" pattern="[0-9]{10}" placeholder="Optional" />

        <label for="addr">Address (Building No, Landmark, Area, City, State, Pincode)</label>
        <textarea id="addr" name="address" placeholder="Building No, Landmark, Area, City, State, Pincode" required></textarea>

        <label for="notes">Any Notes (Size/Color preferences, etc.)</label>
        <textarea id="notes" name="notes" placeholder="Optional"></textarea>

        <label for="summary">Order Summary (auto-filled)</label>
        <textarea id="summary" readonly></textarea>

        <div class="actions">
          <button type="submit" class="cta">Submit Order by Email</button>
          <button type="button" class="btn" id="sendWhatsApp">Send Order via WhatsApp</button>
          <button type="button" class="btn ghost" id="clearBucket">Clear Bucket (Restock)</button>
          <!-- NEW: order processed button -->
          <button type="button" class="btn bucket" id="orderProcessed">Order Processed (Keep Stock)</button>
        </div>
        <p class="muted">Orders go to <strong>salesnityaenterprises@gmail.com</strong> and can also be sent to WhatsApp <strong>+91 9510683160</strong>.</p>
      </form>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="section wrap">
    <h3>Contact Us</h3>
    <p>Email: <a href="mailto:salesnityaenterprises@gmail.com">salesnityaenterprises@gmail.com</a> &nbsp; | &nbsp; Mobile: <a href="tel:+919510683160">+91 9510683160</a></p>
  </section>

  <!-- Exchange Policy -->
  <section id="Exchange Policy" class="section wrap">
    <h3>Exchange Policy</h3>
    <ul>
      <li><strong>How to request:</strong> Share your order details along with a <strong>clear video recorded while unpacking the product</strong> via the <a href="#contact">Contact Us</a> details, or WhatsApp us at <strong>+91 95106 83160</strong>.</li>
      <li>Mention the reason for exchange (size issue, wrong item, damaged item, etc.).</li>
    </ul>
  </section>

  <footer>
    <div class="wrap">
      <div>© <span id="yr"></span> Nitya Enterprises • Ahmedabad • All India shipping</div>
    </div>
  </footer>

  <!-- Drawer: Bucket -->
  <div class="drawer" id="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle">
    <header class="wrap" style="padding:12px 16px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h4 id="drawerTitle">Your Bucket</h4>
        <button class="btn" id="closeBucket">Close ✕</button>
      </div>
    </header>
    <div class="body" id="cartList"></div>
    <div class="pad" style="border-top:1px solid var(--ring)">
      <div class="row"><span>Items:</span><span id="bucketItems">0</span></div>
      <div class="row total"><span>Total:</span><span id="bucketTotal">₹0</span></div>
      <div class="actions">
        <a class="btn bucket" href="#order" id="goOrder">Proceed to Order</a>
        <button class="btn" id="emptyCart">Empty (Restock)</button>
      </div>
    </div>
  </div>

  <!-- Drawer: Stock Manager -->
  <div class="drawer" id="stockDrawer" role="dialog" aria-modal="true" aria-labelledby="stockTitle">
    <header class="wrap" style="padding:12px 16px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <h4 id="stockTitle">Stock Manager</h4>
        <button class="btn" id="closeStock">Close ✕</button>
      </div>
    </header>
    <div class="body pad">
      <div style="display:grid;gap:10px">
        <input id="stockSearch" placeholder="Search product name..." />
        <select id="stockProduct"></select>
        <select id="stockSize"></select>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="stockQty" type="number" min="0" placeholder="Quantity" style="max-width:140px" />
          <button class="btn" id="applyStock">Set Quantity</button>
          <button class="btn" id="add10">+10</button>
          <button class="btn" id="zeroStock">Set 0</button>
        </div>
        <p class="muted">Tip: choose a product + size, set the available quantity. These numbers drive the “Remaining” chips and button disable state.</p>
      </div>
    </div>
  </div>

  
<!-- Stock Manager Login Modal -->
<div class="modal-backdrop" id="smBackdrop"></div>
<div class="modal" id="smModal" aria-hidden="true" aria-labelledby="smTitle" role="dialog">
  <div class="card">
    <h4 class="title" id="smTitle">Enter Password</h4>
    <p class="muted" style="margin:0 0 10px">Stock Manager is protected.</p>
    <div class="row">
      <input type="password" id="smPass" placeholder="Password" autocomplete="current-password" />
      <button class="btn" id="smToggle" type="button" aria-label="Show password">👁️</button>
    </div>
    <div class="err" id="smErr"></div>
    <div class="actions">
      <button class="btn bucket" id="smLogin" type="button">Login</button>
      <button class="btn" id="smCancel" type="button">Cancel</button>
    </div>
    <p class="muted" style="margin-top:6px">Tip: access is remembered for this browser tab.</p>
  </div>
</div>

<script>
    /* ==============================
       QUICK SETUP
       ============================== */
    const SELLER_WHATSAPP = "+919510683160";
    const UPI_ID = "7990639743@ybl";
    const PAYEE_NAME = "Nitya Enterprises";
    const FREE_SIZE_LABEL = "Free Size";

    /* ===== Catalog (same as your file, trimmed here for brevity) ===== */
    const catalog = [
      {id:"ear-01", name:"German Silver Premium Quality Earings -a ", price:400, cat:"Earrings", img:"assets/earrings images/E-1.jpeg "},
      {id:"ear-02", name:"German Silver Premium Quality Earings -b ", price:420, cat:"Earrings", img:"assets/earrings images/E-2.jpeg "},
      {id:"ear-03", name:"German Silver Premium Quality Earings -c ", price:420, cat:"Earrings", img:"assets/earrings images/E-3.jpeg "},
      {id:"ear-04", name:"German Silver Premium Quality Earings -d ", price:600, cat:"Earrings", img:"assets/earrings images/E-4.jpeg "},
      {id:"ear-05", name:"German Silver Premium Quality Earings -e ", price:420, cat:"Earrings", img:"assets/earrings images/E-5.jpeg "},
      {id:"ear-06", name:"Oxides Fancy Earcup Earrings -a  ", price:340, cat:"Earrings", img:"assets/earrings images/E-6.jpeg "},
      {id:"ear-07", name:"Oxides Fancy Earcup Earrings-b  ", price:340, cat:"Earrings", img:"assets/earrings images/E-7.jpeg "},
      {id:"ear-08", name:"Oxides Fancy Earcup Earrings-c  ", price:340, cat:"Earrings", img:"assets/earrings images/E-8.jpeg "},
      {id:"ear-09", name:"Oxides Fancy Earcup Earrings-d  ", price:340, cat:"Earrings", img:"assets/earrings images/E-9.jpeg "},
      {id:"ear-10", name:"Oxides Fancy Earcup Earrings-e  ", price:340, cat:"Earrings", img:"assets/earrings images/E-10.jpeg "},

      {id:"neck-01", name:"German Silver Premium Quality Necklace-a", price:2080, cat:"Necklaces", img:"assets/necklaces images/N-1.jpeg"},
      /* ... keep all your items here exactly as in your file ... */

      {id:"ring-01", name:"German Silver Premium Quality Free Size ring-a ", price:390, cat:"Rings", img:"assets/Ring 2_1_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},
      {id:"ring-02", name:"German Silver Premium Quality Free Size ring-b", price:200, cat:"Rings", img:"assets/Ring 3_2_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},
      {id:"ring-03", name:"German Silver Premium Quality Free Size ring-c", price:200, cat:"Rings", img:"assets/Ring 4_3_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},
      {id:"ring-04", name:"German Silver Premium Quality Free Size ring-d", price:200, cat:"Rings", img:"assets/Ring 5_4_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},
      {id:"ring-05", name:"German Silver Premium Quality Free Size ring-e", price:200, cat:"Rings", img:"assets/Ring 6_5_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},
      {id:"ring-06", name:"German Silver Premium Quality Free Size ring-f", price:650, cat:"Rings", img:"assets/Ring1_6_11zon.jpeg", sizes:["Free Size","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]},

      {id:"ban-01", name:"Oxides Fancy Bacchu Kada -a (pair)  ", price:450 , cat:"Bangles", img:"assets/images/bangles/B-1.jpeg"},
      /* ... keep bangles & clothing ... */
      {id:"cc-01", name:"Navratri Chaniya choli-a", price:2649, cat:"Chaniya Choli", img:"assets/chaniya choli images/CC-1.jpeg"},
      /* ... keep rest of your catalog unchanged ... */
      {id:"kurta-01", name:"Men's Kurta", price:1599, cat:"Kurta", img:"https://via.placeholder.com/800x600?text=Kurta+1"}
    ];

    // Default sizes for categories (used when a product has no explicit sizes)
    const DEFAULT_SIZES = {
      "Chaniya Choli": ["Free Size","S","M","L","XL","XXL"],
      "Kurtis": ["Free Size","S","M","L","XL","XXL"],
      "Kurta": ["Free Size","S","M","L","XL","XXL"],
      "Bangles": ["2.2","2.4","2.6","2.8","2.10","2.12"]
    };

    /* ===== State ===== */
    const selectedSize = new Map();                    // pid -> size
    const CART_KEY = 'nitya_cart_v4_sizes';
    const cart = JSON.parse(localStorage.getItem(CART_KEY) || '{}');

    // ===== INVENTORY (per product-size) =====
    const INVENTORY_KEY = 'nitya_inventory_v1';
    const inventory = JSON.parse(localStorage.getItem(INVENTORY_KEY) || '{}');

    function invKey(pid, size){ return size ? `${pid}__${size}` : `${pid}__ONE`; }
    function getSizesFor(p){
      return (Array.isArray(p.sizes) && p.sizes.length) ? p.sizes : (DEFAULT_SIZES[p.cat] || []);
    }
    function getStock(pid, size){
      const key = invKey(pid,size);
      const val = Number(inventory[key]);
      return Number.isFinite(val) ? Math.max(0, val) : 0;
    }
    function setStock(pid, size, qty){
      inventory[invKey(pid,size)] = Math.max(0, Number(qty)||0);
      localStorage.setItem(INVENTORY_KEY, JSON.stringify(inventory));
    }
    function adjustStock(pid, size, delta){
      const q = getStock(pid,size);
      setStock(pid,size, q + Number(delta||0));
    }

    /* ===== Cart helpers ===== */
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    function parseCartId(cid){ const [pid,size] = cid.split('__'); return {pid,size}; }
    function cartItems(){
      return Object.entries(cart).map(([cid,q])=>{
        const {pid,size} = parseCartId(cid);
        const base = catalog.find(p=>p.id===pid);
        if(!base) return null;
        return {...base, cid, size, qty:q};
      }).filter(Boolean);
    }
    function cartTotal(){ return cartItems().reduce((s,i)=> s + i.price*i.qty, 0); }

    // add/remove that also touches inventory
    function addItem(cid, qty=1){
      const {pid,size} = parseCartId(cid);
      if(getStock(pid,size) < qty){ alert('Insufficient stock for the selected size.'); return; }
      cart[cid] = (cart[cid]||0) + qty;
      adjustStock(pid,size, -qty);   // take from stock
      if(cart[cid] <= 0){ delete cart[cid]; }
      saveCart(); refresh();
    }
    function removeItem(cid, qty=1){
      const {pid,size} = parseCartId(cid);
      if(!cart[cid]) return;
      cart[cid] -= qty;
      if(cart[cid] <= 0) delete cart[cid];
      adjustStock(pid,size, +qty);   // put back to stock
      saveCart(); refresh();
    }
    // clearCart with choice to restock or not
    function clearCart({restock=true} = {}){
      const items = cartItems();
      if(restock){
        items.forEach(it => adjustStock(it.id, it.size, it.qty));
      }
      for(const k in cart) delete cart[k];
      saveCart(); refresh();
    }

    /* ===== Render Catalog with live stock chips ===== */
    function renderCatalog(){
      document.querySelectorAll('[data-grid]').forEach(g => g.innerHTML = "");
      catalog.forEach(p => {
        const grid = document.querySelector(`[data-grid="${p.cat}"]`);
        if(!grid) return;

        const card = document.createElement('div');
        card.className = 'card';

        const sizes = getSizesFor(p);
        let sizeBlock = '';
        if(sizes.length){
          const opts = sizes.map(sz => {
            const st = getStock(p.id, sz);
            const disabled = st <= 0 ? 'disabled' : '';
            const pressed = selectedSize.get(p.id)===sz;
            return `<button class="size-btn" data-size="${sz}" data-for="${p.id}" aria-pressed="${pressed}" ${disabled}>
                      <span>${sz}</span>
                      <span class="stockchip" title="Remaining">${st}</span>
                    </button>`;
          }).join('');
          const hint = (p.cat === "Bangles") ? "" : `<div class="size-hint"><strong>Currently Available Size:</strong> ${FREE_SIZE_LABEL}</div>`;
          sizeBlock = `<div class="sizes" role="group" aria-label="Select size">${opts}</div>${hint}`;
        }else{
          // one-size item: show stock of __ONE
          const st = getStock(p.id, null);
          sizeBlock = `<div class="size-hint"><strong>Remaining:</strong> ${st}</div>`;
        }

        card.innerHTML = `
          <img class="thumb" src="${p.img}" alt="${p.name}"/>
          <div class="pad">
            <div class="title">${p.name}</div>
            <div class="price">₹${p.price.toLocaleString()}</div>
            ${sizeBlock}
            <div class="btns">
              <button class="btn add" data-add="${p.id}">Add to Bucket</button>
              <button class="btn remove" data-remove="${p.id}">Remove</button>
            </div>
          </div>`;
        grid.appendChild(card);
      });
    }

    /* ===== UI (cart) ===== */
    const bucketCount = document.getElementById('bucketCount');
    const bucketTotal = document.getElementById('bucketTotal');
    const bucketItemsEl = document.getElementById('bucketItems');
    const cartList = document.getElementById('cartList');
    const grandTotal = document.getElementById('grandTotal');
    const orderSummary = document.getElementById('summary');
    const hiddenDetails = document.getElementById('order_details');
    const hiddenTotal = document.getElementById('order_total');

    function refresh(){
      // re-render stock chips so the numbers/disabled state update live
      renderCatalog();

      const items = cartItems();
      const total = cartTotal();
      bucketCount.textContent = items.reduce((s,i)=>s+i.qty,0);
      bucketItemsEl.textContent = bucketCount.textContent;
      bucketTotal.textContent = `₹${total.toLocaleString()}`;
      grandTotal.textContent = `₹${total.toLocaleString()}`;

      cartList.innerHTML = items.length ? '' : '<p class="muted">Your bucket is empty. Add some products!</p>';
      items.forEach(it => {
        const row = document.createElement('div');
        row.className = 'cart-item';
        const sizeText = it.size ? ` <span class="small">(Size ${it.size})</span>` : '';
        row.innerHTML = `
          <img src="${it.img}" alt="${it.name}">
          <div>
            <div class="title">${it.name}${sizeText}</div>
            <div class="small">Qty: ${it.qty} × ₹${it.price.toLocaleString()}</div>
          </div>
          <div>
            <button class="btn" onclick="addItem('${it.cid}',1)">+1</button>
            <button class="btn" onclick="removeItem('${it.cid}',1)">−1</button>
          </div>`;
        cartList.appendChild(row);
      });

      const lines = items.map(it => `• ${it.name}${it.size ? ' (Size ' + it.size + ')' : ''} — Qty ${it.qty} — ₹${(it.qty*it.price).toLocaleString()}`);
      const summaryText = (lines.join('\n') || 'No items in bucket') + `\n\nTotal: ₹${total.toLocaleString()}`;
      orderSummary.value = summaryText;
      hiddenDetails.value = summaryText;
      hiddenTotal.value = total;

      updateUpi(total);
    }

    /* ===== Click handlers (size select, add/remove) ===== */
    document.addEventListener('click', (e)=>{
      const sizeBtn = e.target.closest('.size-btn');
      if(sizeBtn){
        const pid = sizeBtn.getAttribute('data-for');
        const sz = sizeBtn.getAttribute('data-size');
        selectedSize.set(pid, sz);
        // visually toggle
        const card = sizeBtn.closest('.card');
        card.querySelectorAll(`.size-btn[data-for="${pid}"]`).forEach(b=>b.setAttribute('aria-pressed','false'));
        sizeBtn.setAttribute('aria-pressed','true');
      }

      const add = e.target.closest('[data-add]');
      const rem = e.target.closest('[data-remove]');

      if(add){
        const pid = add.dataset.add;
        const product = catalog.find(p=>p.id===pid);
        const sizes = getSizesFor(product);
        if(sizes.length){
          const sel = selectedSize.get(pid);
          if(!sel){ alert('Please select a size before adding to the bucket.'); return; }
          addItem(`${pid}__${sel}`,1);
        }else{
          // one-size item uses __ONE
          if(getStock(pid,null) <= 0){ alert('Out of stock.'); return; }
          addItem(`${pid}__ONE`,1);
        }
      }
      if(rem){
        const pid = rem.dataset.remove;
        const product = catalog.find(p=>p.id===pid);
        const sizes = getSizesFor(product);
        if(sizes.length){
          const sel = selectedSize.get(pid);
          if(!sel){ alert('Select a size to remove.'); return; }
          removeItem(`${pid}__${sel}`,1);
        }else{
          removeItem(`${pid}__ONE`,1);
        }
      }
    });

    /* ===== Drawers ===== */
    const drawer = document.getElementById('drawer');
    document.getElementById('openBucket').addEventListener('click', ()=>drawer.classList.add('open'));
    document.getElementById('closeBucket').addEventListener('click', ()=>drawer.classList.remove('open'));
    document.getElementById('goOrder').addEventListener('click', ()=>drawer.classList.remove('open'));
    document.getElementById('emptyCart').addEventListener('click', ()=>{ if(confirm('Clear all items and RESTOCK them?')) clearCart({restock:true}); });
    document.getElementById('clearBucket').addEventListener('click', ()=>{ if(confirm('Clear all items and RESTOCK them?')) clearCart({restock:true}); });
    document.getElementById('orderProcessed').addEventListener('click', ()=>{ if(confirm('Mark order processed? This will NOT restock the items.')) clearCart({restock:false}); });

    /* ===== Stock Manager Drawer ===== */
    const stockDrawer = document.getElementById('stockDrawer');
    const openStock = document.getElementById('openStock');
    const closeStock = document.getElementById('closeStock');
    const stockSearch = document.getElementById('stockSearch');
    const stockProduct = document.getElementById('stockProduct');
    const stockSize = document.getElementById('stockSize');
    const stockQty = document.getElementById('stockQty');
    const applyStock = document.getElementById('applyStock');
    const add10 = document.getElementById('add10');
    const zeroStock = document.getElementById('zeroStock');

    openStock.addEventListener('click', ()=>{
  if (sessionStorage.getItem('nitya_stock_auth') === '1') {
    buildProductList(); stockDrawer.classList.add('open');
  } else {
    openSmLogin();
  }
});
    closeStock.addEventListener('click', ()=>stockDrawer.classList.remove('open'));

    function buildProductList(){
      const q = (stockSearch.value||'').toLowerCase();
      stockProduct.innerHTML = '';
      catalog.filter(p => p.name.toLowerCase().includes(q) || p.id.toLowerCase().includes(q))
             .forEach(p=>{
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = `${p.name} — [${p.cat}]`;
                stockProduct.appendChild(opt);
             });
      buildSizeList();
    }
    function buildSizeList(){
      const pid = stockProduct.value;
      const p = catalog.find(x=>x.id===pid);
      const sizes = getSizesFor(p);
      stockSize.innerHTML = '';
      if(sizes.length){
        sizes.forEach(s=>{
          const o = document.createElement('option');
          o.value = s; o.textContent = `${s} (Remaining ${getStock(pid,s)})`;
          stockSize.appendChild(o);
        });
      }else{
        const o = document.createElement('option');
        o.value = 'ONE'; o.textContent = `ONE (Remaining ${getStock(pid,null)})`;
        stockSize.appendChild(o);
      }
      updateQtyField();
    }
    function updateQtyField(){
      const pid = stockProduct.value;
      const s = stockSize.value;
      const qty = (s==='ONE') ? getStock(pid,null) : getStock(pid,s);
      stockQty.value = qty;
    }
    stockSearch.addEventListener('input', buildProductList);
    stockProduct.addEventListener('change', buildSizeList);
    stockSize.addEventListener('change', updateQtyField);
    applyStock.addEventListener('click', ()=>{
      const pid = stockProduct.value;
      const s = stockSize.value;
      const q = Number(stockQty.value)||0;
      if(s==='ONE') setStock(pid,null,q); else setStock(pid,s,q);
      refresh(); buildSizeList();
    });
    add10.addEventListener('click', ()=>{
      const pid = stockProduct.value; const s = stockSize.value;
      if(s==='ONE') adjustStock(pid,null,10); else adjustStock(pid,s,10);
      refresh(); buildSizeList();
    });
    zeroStock.addEventListener('click', ()=>{
      const pid = stockProduct.value; const s = stockSize.value;
      if(s==='ONE') setStock(pid,null,0); else setStock(pid,s,0);
      refresh(); buildSizeList();
    });

    /* ===== UPI generation (Deep Link + QR) ===== */
    const upiDeepLink = document.getElementById('upiDeepLink');
    const qrBox = document.getElementById('qrBox');
    const copyUpiBtn = document.getElementById('copyUpi');
    const refreshQR = document.getElementById('refreshQR');

    function upiUrl(amount){
      const params = new URLSearchParams({ pa: UPI_ID, pn: PAYEE_NAME, am: String(amount||''), cu: 'INR' });
      return `upi://pay?${params.toString()}`;
    }
    function updateUpi(amount){
      upiDeepLink.href = upiUrl(amount);
      const data = encodeURIComponent(upiUrl(amount));
      const src = `https://api.qrserver.com/v1/create-qr-code/?size=512x512&data=${data}`;
      qrBox.innerHTML = `<img alt="UPI QR Code" width="220" height="220" style="width:100%;height:100%;object-fit:contain" src="${src}">`;
    }
    copyUpiBtn.addEventListener('click', ()=>{
      navigator.clipboard.writeText(UPI_ID).then(()=>{
        copyUpiBtn.textContent='Copied!'; setTimeout(()=>copyUpiBtn.textContent='Copy',1200);
      });
    });
    refreshQR.addEventListener('click', ()=> updateUpi(cartTotal()));

    /* ===== WhatsApp share ===== */
    const sendWhatsApp = document.getElementById('sendWhatsApp');
    sendWhatsApp.addEventListener('click', ()=>{
      const name = document.getElementById('custName').value || '(No name)';
      const mobile = document.getElementById('mobile').value || '(No mobile)';
      const alt = document.getElementById('altContact').value || '-';
      const address = document.getElementById('addr').value || '(No address)';
      const notes = document.getElementById('notes').value || '-';
      const text = `*New Order — Nitya Enterprises*\n\n`+
        `*Customer:* ${name}\n*Mobile:* ${mobile}\n*Alt:* ${alt}\n*Address:* ${address}\n*Notes:* ${notes}\n\n`+
        `${document.getElementById('summary').value}`;
      const url = `https://wa.me/${SELLER_WHATSAPP}?text=${encodeURIComponent(text)}`;
      window.open(url,'_blank','noopener');
    });

    /* ===== Form guard ===== */
    document.getElementById('orderForm').addEventListener('submit', (e)=>{
      if(cartTotal() <= 0){ e.preventDefault(); alert('Your bucket is empty. Please add items before submitting.'); return; }
      if(!document.getElementById('mobile').checkValidity()){ e.preventDefault(); alert('Please enter a valid 10-digit mobile number.'); return; }
      // NOTE: We do NOT restock on submit (treated as processed).
    });

    // init
    document.getElementById('yr').textContent = new Date().getFullYear();
    renderCatalog();
    refresh();
  
/* ===== Stock Manager Password Gate ===== */
const SM_PASS = "nitya@123"; // change here if you ever rotate the password
const smBackdrop = document.getElementById('smBackdrop');
const smModal = document.getElementById('smModal');
const smPass = document.getElementById('smPass');
const smErr = document.getElementById('smErr');
const smLoginBtn = document.getElementById('smLogin');
const smCancelBtn = document.getElementById('smCancel');
const smToggle = document.getElementById('smToggle');

function openSmLogin(){
  smErr.textContent = '';
  smPass.value = '';
  smBackdrop.classList.add('open');
  smModal.setAttribute('aria-hidden','false');
  smPass.type = 'password';
  smToggle.textContent = '👁️';
  setTimeout(()=> smPass.focus(), 0);
}
function closeSmLogin(){
  smBackdrop.classList.remove('open');
  smModal.setAttribute('aria-hidden','true');
}
function trySmLogin(){
  const val = smPass.value.trim();
  if (val === SM_PASS){
    sessionStorage.setItem('nitya_stock_auth','1');
    closeSmLogin();
    buildProductList(); stockDrawer.classList.add('open');
  } else {
    smErr.textContent = 'Incorrect password.';
    smPass.select();
  }
}

smLoginBtn?.addEventListener('click', trySmLogin);
smCancelBtn?.addEventListener('click', closeSmLogin);
smToggle?.addEventListener('click', ()=>{
  smPass.type = (smPass.type === 'password') ? 'text' : 'password';
  smToggle.textContent = (smPass.type === 'password') ? '👁️' : '🙈';
  smPass.focus();
});
smPass?.addEventListener('keydown', (e)=>{ if(e.key==='Enter') trySmLogin(); });
smBackdrop?.addEventListener('click', closeSmLogin);

</script>
</body>
</html>
